---
description: Generate solution architecture with arc42 docs, C4 diagrams, and ADRs
argument-hint: <SystemName>
model: claude-sonnet-4-5-20250929
allowed-tools: Read, Write, Edit, Bash, Task, Glob, Grep
hooks:
  PreToolUse:
    - matcher: "*"
      once: true
      hooks:
        - type: command
          command: "$CLAUDE_PROJECT_DIR/.claude/hooks/log-lifecycle.sh" command /solarch started '{"stage": "solarch"}'
  Stop:
    - hooks:
        - type: command
          command: "$CLAUDE_PROJECT_DIR/.claude/hooks/log-lifecycle.sh" command /solarch ended '{"stage": "solarch"}'
---


# /solarch - Complete Solution Architecture Generation

## FIRST ACTION (MANDATORY)

Before doing ANYTHING else, run these commands:

```bash
# 1. Update session context
bash "$CLAUDE_PROJECT_DIR/.claude/hooks/session-update.sh" --project "{SystemName}" --stage "solarch"

# 2. Log command start
bash .claude/hooks/log-lifecycle.sh command /solarch instruction_start '{"stage": "solarch", "method": "instruction-based"}'
```


---

## v3.0 Architecture Board Mode

**Version**: 3.0.0 (Hierarchical Architecture with Architecture Board)

This command uses a hierarchical multi-agent architecture with:

- **Architecture Board**: 3 Architect personas (Pragmatist, Perfectionist, Skeptic)
- **Weighted Voting Consensus**: Decisions with confidence scores
- **Self-Validation**: Per-ADR quality checks (15-point checklist)
- **4 Entry Points**: System, subsystem, layer, single-ADR
- **Auto-Rework**: Max 2 attempts with OBVIOUS user notification

### Consensus Thresholds
- **Confidence threshold**: >= 60% average confidence
- **Dissent threshold**: <= 40% dissent score
- **Escalation**: AskUserQuestion when thresholds violated

### Quality Modes
| Mode | Flag | Board Reviews | Use Case |
|------|------|---------------|----------|
| Standard | `--quality standard` | P0 ADRs only | Default, balanced |
| Critical | `--quality critical` | ALL ADRs | High-stakes projects |

---

## ğŸ¯ Guiding Architectural Principle

**Optimize for maintainability, not simplicity.**

When making architectural and implementation decisions:

1. **Prioritize long-term maintainability** over short-term simplicity
2. **Minimize complexity** by being strategic with dependencies and libraries
3. **Avoid "simplicity traps"** - adding libraries without considering downstream debugging and maintenance burden
4. **Think 6 months ahead** - will this decision make debugging easier or harder?
5. **Use libraries strategically** - not avoided, but chosen carefully with justification

### Decision-Making Protocol

When facing architectural trade-offs between complexity and maintainability:

**If the decision is clear** â†’ Make the decision autonomously and document the rationale

**If the decision is unclear** â†’ Use `AskUserQuestion` tool with:
- Minimum 3 alternative scenarios
- Clear trade-off analysis for each option
- Maintainability impact assessment (short-term vs long-term)
- Complexity implications (cognitive load, debugging difficulty, dependency graph)
- Recommendation with reasoning

---

## Rules Loading (On-Demand)

This command requires traceability rules for architecture decisions:

```bash
# Load Traceability rules (includes ADR ID format, building blocks)
/rules-traceability
```

## Description

This command orchestrates the complete Solution Architecture generation pipeline (Stage 4), producing arc42-compliant documentation with C4 diagrams, ADRs, and full traceability.

## Arguments

- `$ARGUMENTS` - Required: `<SystemName>` (e.g., InventorySystem)

## Options (v3.0 Entry Points)

| Flag | Description | Example |
|------|-------------|---------|
| `--subsystem <name>` | Filter to subsystem ADRs | `--subsystem authentication` |
| `--layer <name>` | Filter to layer ADRs | `--layer frontend` |
| `--adr <id>` | Single ADR mode | `--adr ADR-007` |
| `--quality <mode>` | Quality mode (`standard`, `critical`) | `--quality critical` |

## Usage

```bash
# System-level (all ADRs) - default
/solarch InventorySystem

# Subsystem-level (66% time savings)
/solarch InventorySystem --subsystem authentication

# Layer-level (75% time savings)
/solarch InventorySystem --layer frontend

# Single ADR (91% time savings)
/solarch InventorySystem --adr ADR-007

# Quality critical mode (board review for ALL ADRs)
/solarch InventorySystem --quality critical

# Combined
/solarch InventorySystem --subsystem authentication --quality critical
```

## Prerequisites

- **Prototype Stage Complete**: `Prototype_<SystemName>/` with Checkpoint 14 passed
- **ProductSpecs Stage Complete**: `ProductSpecs_<SystemName>/` with Checkpoint 8 passed
- Dependencies installed: `/htec-libraries-init`

## Pipeline Position

```
Discovery (Stage 1) â†’ Prototype (Stage 2) â†’ ProductSpecs (Stage 3) â†’ SolArch (Stage 4)
        â†“                    â†“                      â†“                      â†“
ClientAnalysis_X/     Prototype_X/          ProductSpecs_X/          SolArch_X/
```

## Skills Used

Read BEFORE execution:
- `.claude/skills/SolutionArchitecture_Generator/SKILL.md`
- `.claude/skills/SolutionArchitecture_C4Generator/SKILL.md`
- `.claude/skills/SolutionArchitecture_AdrGenerator/SKILL.md`
- `.claude/skills/SolutionArchitecture_Arc42Generator/SKILL.md`
- `.claude/skills/SolutionArchitecture_InformationDesignGenerator/SKILL.md`
- `.claude/skills/SolutionArchitecture_E2ETraceabiliyAnalyzer/SKILL.md`

## Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 SOLUTION ARCHITECTURE PIPELINE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Phase 0: Initialization (Checkpoint 0)                        â”‚
â”‚  â”œâ”€â”€ Create folder structure                                   â”‚
â”‚  â”œâ”€â”€ Initialize _state/solarch_config.json                     â”‚
â”‚  â””â”€â”€ Initialize _state/solarch_progress.json                   â”‚
â”‚                                                                 â”‚
â”‚  Phase 1: Input Validation (Checkpoint 1) [BLOCKING]           â”‚
â”‚  â”œâ”€â”€ Validate ProductSpecs completeness                        â”‚
â”‚  â”œâ”€â”€ Validate Prototype completeness                           â”‚
â”‚  â””â”€â”€ Extract input summaries                                   â”‚
â”‚                                                                 â”‚
â”‚  Phase 2: Context & Goals (Checkpoint 2)                       â”‚
â”‚  â”œâ”€â”€ Generate 01-introduction-goals/                           â”‚
â”‚  â”œâ”€â”€ Generate 02-constraints/                                  â”‚
â”‚  â””â”€â”€ Generate 03-context-scope/                                â”‚
â”‚                                                                 â”‚
â”‚  Phase 3: Solution Strategy (Checkpoint 3)                     â”‚
â”‚  â”œâ”€â”€ Generate 04-solution-strategy/                            â”‚
â”‚  â””â”€â”€ Generate foundation ADRs (ADR-001, ADR-002)               â”‚
â”‚                                                                 â”‚
â”‚  Phase 4: Building Blocks (Checkpoint 4)                       â”‚
â”‚  â”œâ”€â”€ Generate 05-building-blocks/                              â”‚
â”‚  â”œâ”€â”€ Generate C4 diagrams                                      â”‚
â”‚  â””â”€â”€ Register components in _registry/                         â”‚
â”‚                                                                 â”‚
â”‚  Phase 5: Runtime & Integration (Checkpoint 5)                 â”‚
â”‚  â”œâ”€â”€ Generate 06-runtime/ scenarios                            â”‚
â”‚  â”œâ”€â”€ Generate API design docs                                  â”‚
â”‚  â””â”€â”€ Generate event communication docs                         â”‚
â”‚                                                                 â”‚
â”‚  Phase 6: Quality & Cross-cutting (Checkpoint 6)               â”‚
â”‚  â”œâ”€â”€ Generate 07-quality/                                      â”‚
â”‚  â”œâ”€â”€ Generate security architecture                            â”‚
â”‚  â””â”€â”€ Generate cross-cutting concerns                           â”‚
â”‚                                                                 â”‚
â”‚  Phase 7: Deployment (Checkpoint 7)                            â”‚
â”‚  â”œâ”€â”€ Generate 08-deployment/                                   â”‚
â”‚  â””â”€â”€ Generate operations guide                                 â”‚
â”‚                                                                 â”‚
â”‚  Phase 8: Decisions (Checkpoint 8)                             â”‚
â”‚  â”œâ”€â”€ Complete all ADRs (09-decisions/)                         â”‚
â”‚  â””â”€â”€ Generate decision index                                   â”‚
â”‚                                                                 â”‚
â”‚  Phase 9: Risks (Checkpoint 9)                                 â”‚
â”‚  â””â”€â”€ Generate 10-risks/                                        â”‚
â”‚                                                                 â”‚
â”‚  Phase 10: Documentation (Checkpoint 10)                       â”‚
â”‚  â””â”€â”€ Generate 11-glossary/                                     â”‚
â”‚                                                                 â”‚
â”‚  Phase 11: Traceability (Checkpoint 11) [BLOCKING]             â”‚
â”‚  â”œâ”€â”€ Validate all chains                                       â”‚
â”‚  â”œâ”€â”€ 100% pain point coverage                                  â”‚
â”‚  â””â”€â”€ 100% module architecture coverage                         â”‚
â”‚                                                                 â”‚
â”‚  Phase 12: Finalization (Checkpoint 12)                        â”‚
â”‚  â”œâ”€â”€ Generate VALIDATION_REPORT.md                             â”‚
â”‚  â””â”€â”€ Generate GENERATION_SUMMARY.md                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Execution Steps

### Step 1: Initialize Variables

```
IF NOT SYSTEM_NAME:
  PROMPT: "Enter system name (e.g., InventorySystem):"
  SYSTEM_NAME = user_input

SET paths:
  PROTOTYPE_PATH = "Prototype_{SYSTEM_NAME}"
  PRODUCTSPECS_PATH = "ProductSpecs_{SYSTEM_NAME}"
  OUTPUT_PATH = "SolArch_{SYSTEM_NAME}"
  ROOT_STATE = "_state"
  ROOT_TRACE = "traceability"
```

### Step 2: Execute Checkpoints

```
FOR checkpoint IN [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]:
  EXECUTE checkpoint:
    0: /solarch-init {SYSTEM_NAME}
    1: /solarch-validate {SYSTEM_NAME}
    2: /solarch-context {SYSTEM_NAME}
    3: /solarch-strategy {SYSTEM_NAME}
    4: /solarch-blocks {SYSTEM_NAME}
    5: /solarch-runtime {SYSTEM_NAME}
    6: /solarch-quality {SYSTEM_NAME}
    7: /solarch-deploy {SYSTEM_NAME}
    8: /solarch-decisions {SYSTEM_NAME}
    9: /solarch-risks {SYSTEM_NAME}
    10: /solarch-docs {SYSTEM_NAME}
    11: /solarch-trace {SYSTEM_NAME}
    12: /solarch-finalize {SYSTEM_NAME}

  RUN quality gate:
    python3 .claude/hooks/solarch_quality_gates.py --validate-checkpoint {checkpoint} --dir {OUTPUT_PATH}/

  IF checkpoint is BLOCKING AND validation fails:
    STOP and show fix instructions

DISPLAY completion summary

## Output Structure

```
project_root/
â”œâ”€â”€ _state/                              # SHARED (ROOT)
â”‚   â”œâ”€â”€ solarch_config.json
â”‚   â”œâ”€â”€ solarch_progress.json
â”‚   â”œâ”€â”€ solarch_input_validation.json
â”‚   â””â”€â”€ FAILURES_LOG.md
â”‚
â”œâ”€â”€ traceability/                        # SHARED (ROOT)
â”‚   â””â”€â”€ solarch_traceability_register.json
â”‚
â””â”€â”€ SolArch_<SystemName>/                # OUTPUT
    â”œâ”€â”€ 01-introduction-goals/
    â”‚   â”œâ”€â”€ introduction.md
    â”‚   â””â”€â”€ stakeholders.md
    â”‚
    â”œâ”€â”€ 02-constraints/
    â”‚   â”œâ”€â”€ business-constraints.md
    â”‚   â”œâ”€â”€ technical-constraints.md
    â”‚   â””â”€â”€ regulatory-constraints.md
    â”‚
    â”œâ”€â”€ 03-context-scope/
    â”‚   â”œâ”€â”€ business-context.md
    â”‚   â””â”€â”€ technical-context.md
    â”‚
    â”œâ”€â”€ 04-solution-strategy/
    â”‚   â””â”€â”€ solution-strategy.md
    â”‚
    â”œâ”€â”€ 05-building-blocks/
    â”‚   â”œâ”€â”€ overview.md
    â”‚   â”œâ”€â”€ cross-cutting.md
    â”‚   â”œâ”€â”€ data-model/
    â”‚   â”‚   â””â”€â”€ README.md
    â”‚   â””â”€â”€ modules/
    â”‚       â””â”€â”€ <module-slug>/
    â”‚           â”œâ”€â”€ README.md
    â”‚           â””â”€â”€ c4-component.mermaid
    â”‚
    â”œâ”€â”€ 06-runtime/
    â”‚   â”œâ”€â”€ api-design.md
    â”‚   â”œâ”€â”€ event-communication.md
    â”‚   â””â”€â”€ security-architecture.md
    â”‚
    â”œâ”€â”€ 07-quality/
    â”‚   â”œâ”€â”€ quality-requirements.md
    â”‚   â””â”€â”€ testing-strategy.md
    â”‚
    â”œâ”€â”€ 08-deployment/
    â”‚   â”œâ”€â”€ deployment-view.md
    â”‚   â”œâ”€â”€ operations-guide.md
    â”‚   â””â”€â”€ runbooks/
    â”‚       â””â”€â”€ RB-*.md
    â”‚
    â”œâ”€â”€ 09-decisions/
    â”‚   â”œâ”€â”€ ADR-001-architecture-style.md
    â”‚   â”œâ”€â”€ ADR-002-technology-stack.md
    â”‚   â”œâ”€â”€ ADR-003-module-structure.md
    â”‚   â”œâ”€â”€ ADR-004-data-storage.md
    â”‚   â”œâ”€â”€ ADR-005-api-design.md
    â”‚   â”œâ”€â”€ ADR-006-event-communication.md
    â”‚   â”œâ”€â”€ ADR-007-security-architecture.md
    â”‚   â”œâ”€â”€ ADR-008-caching-strategy.md
    â”‚   â””â”€â”€ ADR-009-observability.md
    â”‚
    â”œâ”€â”€ 10-risks/
    â”‚   â””â”€â”€ risks-technical-debt.md
    â”‚
    â”œâ”€â”€ 11-glossary/
    â”‚   â””â”€â”€ glossary.md
    â”‚
    â”œâ”€â”€ _registry/
    â”‚   â”œâ”€â”€ components.json
    â”‚   â”œâ”€â”€ decisions.json
    â”‚   â”œâ”€â”€ architecture-traceability.json
    â”‚   â”œâ”€â”€ VALIDATION_REPORT.md
    â”‚   â””â”€â”€ GENERATION_SUMMARY.md
    â”‚
    â””â”€â”€ diagrams/
        â”œâ”€â”€ c4-context.mermaid
        â”œâ”€â”€ c4-container.mermaid
        â””â”€â”€ c4-deployment.mermaid
```

## Traceability Chain

```
CM-XXX (Client Material)
    â†“
PP-X.X (Pain Point)
    â†“
JTBD-X.X (Job To Be Done)
    â†“
REQ-XXX (Requirement)
    â†“
MOD-XXX (Module Spec)
    â†“
ADR-XXX (Architecture Decision)
    â†“
COMP-XXX (Component)
    â†“
QS-XXX (Quality Scenario)
```

## Checkpoint Requirements

| CP | Phase | Required Files | Validation | Blocking |
|----|-------|----------------|------------|----------|
| 0 | Init | Config, folders | Structure | No |
| 1 | Validate | Input validation | Complete check | **YES** |
| 2 | Context | Introduction, constraints, context | Content | No |
| 3 | Strategy | Solution strategy, ADR-001, ADR-002 | Content | No |
| 4 | Blocks | Building blocks, modules, C4 | Coverage | No |
| 5 | Runtime | API design, events | Content | No |
| 6 | Quality | Quality reqs, security | Content | No |
| 7 | Deploy | Deployment view, ops guide | Content | No |
| 8 | Decisions | All ADRs, decisions.json | Min 9 ADRs | No |
| 9 | Risks | Risks doc | Content | No |
| 10 | Docs | Glossary | Content | No |
| 11 | Trace | Traceability | 100% coverage | **YES** |
| 12 | Final | Validation report | Complete | No |

## Error Handling

```
ERROR â†’ SKIP â†’ CONTINUE â†’ NEVER RETRY
```

- File read fails â†’ Log to `_state/FAILURES_LOG.md`, continue
- Phase fails blocking checkpoint â†’ Stop, require fix
- Phase fails non-blocking â†’ Continue with warnings
- Never pip install, never retry, never ask

## Quality Gates

```bash
# List checkpoints
python3 .claude/hooks/solarch_quality_gates.py --list-checkpoints

# Validate checkpoint
python3 .claude/hooks/solarch_quality_gates.py --validate-checkpoint N --dir SolArch_X/

# Validate ADR file
python3 .claude/hooks/solarch_quality_gates.py --validate-file SolArch_X/09-decisions/ADR-001.md

# Validate traceability
python3 .claude/hooks/solarch_quality_gates.py --validate-traceability --dir SolArch_X/
```

## Related Commands

| Command | Description |
|---------|-------------|
| `/solarch-resume` | Resume from last checkpoint |
| `/solarch-status` | Show current progress |
| `/solarch-reset` | Reset state |
| `/solarch-feedback` | Process change requests |

## Example

```bash
# Full generation
/solarch InventorySystem

# This will:
# 1. Validate Prototype_InventorySystem/ and ProductSpecs_InventorySystem/
# 2. Generate SolArch_InventorySystem/ with all documentation
# 3. Create 9+ ADRs with full traceability
# 4. Generate C4 diagrams
# 5. Validate 100% coverage
```
