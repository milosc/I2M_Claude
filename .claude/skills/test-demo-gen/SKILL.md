---
name: test-demo-gen
allowed-tools: Bash
description: Use when you need to test the framework skill system by generating Lorem Ipsum test output. This skill demonstrates deterministic lifecycle logging via frontmatter hooks.
context: main
agent: general-purpose
hooks:
  PreToolUse:
    - matcher: "*"
      once: true
      hooks:
        - type: command
          command: "$CLAUDE_PROJECT_DIR/.claude/hooks/log-lifecycle.sh" skill test-demo-gen started
  Stop:
    - hooks:
        - type: command
          command: "$CLAUDE_PROJECT_DIR/.claude/hooks/log-lifecycle.sh" skill test-demo-gen ended
---

# Test Demo Skill - Deterministic Lifecycle Logging

This skill demonstrates the framework's skill system with **deterministic lifecycle logging**.

## When to Use

- Testing framework functionality
- Demonstrating skill execution flow with lifecycle logging
- Verifying frontmatter hooks work correctly
- Learning how skills integrate with the framework

## Lifecycle Logging Architecture

This skill uses **deterministic frontmatter hooks**:

| Event | Hook Type | Deterministic |
|-------|-----------|---------------|
| START | `PreToolUse` (once:true) | Partial (fires on first tool use) |
| END | `Stop` | Yes (always fires when skill ends) |

**Logging Output**: `_state/lifecycle.json`

## FIRST ACTION (MANDATORY)

Before doing anything else, run this command to ensure start is logged:

```bash
"$CLAUDE_PROJECT_DIR/.claude/hooks/log-lifecycle.sh" skill test-demo-gen instruction_start '{"method": "instruction-based"}'
```

This is a **workaround** for the known limitation that `PreToolUse` only fires when tools are used.

---

## Arguments

Accepts arguments in format: `--output <path> --paragraphs <N>`

Example:
```bash
--output _state/test-demo-outputs/skill-output.md --paragraphs 4
```

## Execution

### Step 1: Parse Arguments

```bash
# Parse arguments passed from Skill() tool
OUTPUT_FILE="_state/test-demo-skill-output.md"  # Default
PARAGRAPHS=4  # Default

# Override with args if provided
for arg in "$@"; do
  case $arg in
    --output=*) OUTPUT_FILE="${arg#*=}" ;;
    --paragraphs=*) PARAGRAPHS="${arg#*=}" ;;
  esac
done

# Also handle space-separated args
while [[ $# -gt 0 ]]; do
  case $1 in
    --output) OUTPUT_FILE="$2"; shift 2 ;;
    --paragraphs) PARAGRAPHS="$2"; shift 2 ;;
    *) shift ;;
  esac
done

echo "Test Demo Skill Executing"
echo "Output: $OUTPUT_FILE"
echo "Paragraphs: $PARAGRAPHS"
echo ""
```

### Step 2: Generate Content

```bash
# Execute skill logic - generate Lorem Ipsum content
python3 .claude/hooks/test_demo_hook.py \
  --output "$OUTPUT_FILE" \
  --paragraphs "$PARAGRAPHS" \
  --title "Skill Generated Content" \
  --source "test-demo-gen (skill)"

echo ""
```

### Step 3: Verify Output

```bash
# Verify file was created
if [ -f "$OUTPUT_FILE" ]; then
  SIZE=$(wc -c < "$OUTPUT_FILE")
  echo "Skill execution successful"
  echo "Output file: $OUTPUT_FILE ($SIZE bytes)"
  echo ""
  echo "File preview:"
  echo "================"
  head -20 "$OUTPUT_FILE"
else
  echo "Skill execution failed"
  echo "Expected output: $OUTPUT_FILE"
fi
```

### Step 4: Summary

```bash
echo ""
echo "Skill Execution Summary"
echo "========================"
echo "Skill: test-demo-gen"
echo "Output: $OUTPUT_FILE"
echo "Paragraphs: $PARAGRAPHS"
echo ""
echo "Lifecycle events logged to: _state/lifecycle.json"
echo "  - skill:test-demo-gen:started (via PreToolUse hook)"
echo "  - skill:test-demo-gen:ended (via Stop hook)"
```

---

## Output

### Generated File

The skill produces a markdown file at the specified output path:

```markdown
# Skill Generated Content

> Generated by: `test-demo-gen (skill)`
> Timestamp: 2026-01-12T10:00:00

---

## Content

Lorem ipsum dolor sit amet, consectetur adipiscing elit...

---

## Metadata

| Property | Value |
|----------|-------|
| Source | test-demo-gen (skill) |
| Paragraphs | 4 |
| Generated | 2026-01-12T10:00:00 |
```

### Expected Lifecycle Events

After execution, `_state/lifecycle.json` should contain:

```json
{"component": "skill", "name": "test-demo-gen", "event": "started", "timestamp": "...", "session": "..."}
{"component": "skill", "name": "test-demo-gen", "event": "ended", "timestamp": "...", "session": "..."}
```

---

## Integration

| Component | Role |
|-----------|------|
| `test_demo_hook.py` | Content generation |
| `log-lifecycle.sh` | Lifecycle event logging |
| `settings.json` | Global Skill invocation logging |
| `lifecycle.json` | Event storage |

## Related

- **Hook**: `.claude/hooks/test_demo_hook.py`
- **Helper**: `.claude/hooks/log-lifecycle.sh`
- **Agent**: `.claude/agents/test-demo-agent.md`
- **Command**: `.claude/commands/test-demo.md`
- **Documentation**: `architecture/Framework_Test_Demo.md`
