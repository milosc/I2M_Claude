import{c as U,d as q}from"./ListLayout-8Q9Kcx4Y.js";import{at as k,az as w}from"./Virtualizer-43kePMo2.js";const o={minItemSize:new k(200,200),maxItemSize:new k(1/0,1/0),preserveAspectRatio:!1,minSpace:new k(18,18),maxSpace:1/0,maxColumns:1/0,dropIndicatorThickness:2};class G extends U{shouldInvalidateLayoutOptions(e,t){return e.maxColumns!==t.maxColumns||e.dropIndicatorThickness!==t.dropIndicatorThickness||e.preserveAspectRatio!==t.preserveAspectRatio||!(e.minItemSize||o.minItemSize).equals(t.minItemSize||o.minItemSize)||!(e.maxItemSize||o.maxItemSize).equals(t.maxItemSize||o.maxItemSize)||!(e.minSpace||o.minSpace).equals(t.minSpace||o.minSpace)||e.maxHorizontalSpace!==t.maxHorizontalSpace}update(e){let{minItemSize:t=o.minItemSize,maxItemSize:i=o.maxItemSize,preserveAspectRatio:l=o.preserveAspectRatio,minSpace:n=o.minSpace,maxHorizontalSpace:h=o.maxSpace,maxColumns:x=o.maxColumns,dropIndicatorThickness:M=o.dropIndicatorThickness}=e.layoutOptions||{};this.dropIndicatorThickness=M;let m=this.virtualizer.visibleRect.width,s=Math.min(i.width,m),S=Number.isFinite(i.height)?i.height:Math.floor(t.height/t.width*s),d=Math.floor(m/(t.width+n.width)),a=Math.max(1,Math.min(x,d));this.numColumns=a;let b=m-n.width*Math.max(0,a),r=Math.floor(b/a);r=Math.max(t.width,Math.min(s,r));let u=(r-t.width)/Math.max(1,s-t.width),A=t.height+Math.floor((S-t.height)*u);A=Math.max(t.height,Math.min(S,A));let v=Math.min(Math.max(h,n.width),Math.floor((m-a*r)/(a+1)));this.gap=new k(v,n.height),this.margin=Math.floor((m-a*r-v*(a+1))/2);let p=this.virtualizer.collection,F=p.size,P=p.getLastKey();for(let f=0;f<2&&P!=null;f++){let c=p.getItem(P);if((c==null?void 0:c.type)==="skeleton"){F++;break}P=p.getKeyBefore(P)}let R=Math.ceil(F/a),X=p[Symbol.iterator](),$=R>0?n.height:0,D=new Map,I=null,Y=0;for(let f=0;f<R;f++){let c=0,N=[];for(let T=0;T<a;T++){let y=I||X.next().value;if(!y)break;if(y.type==="loader")continue;y.type==="skeleton"&&(I=y);let L=I?`${I.key}-${Y++}`:y.key,g=this.layoutInfos.get(L),H=y;I&&(H=g&&g.content.key===L?g.content:{...I,key:L});let B=v+T*(r+v)+this.margin,W=A,K=!l;g&&K&&(W=g.rect.height,K=e.layoutOptionsChanged||e.sizeChanged||g.estimatedSize||g.content!==H);let E=new w(B,$,r,W),z=new q(y.type,L,E);z.estimatedSize=K,z.allowOverflow=!0,z.content=H,D.set(L,z),N.push(z),c=Math.max(c,z.rect.height)}for(let T of N)T.rect.height=c;$+=c+n.height,I&&f===R-1&&$<this.virtualizer.visibleRect.height&&R++}let C=p.getItem(p.getLastKey());if((C==null?void 0:C.type)==="loader"){let f=new w(v,$,r,0),c=new q("loader",C.key,f);D.set(C.key,c)}this.layoutInfos=D,this.contentSize=new k(this.virtualizer.visibleRect.width,$)}getLayoutInfo(e){return this.layoutInfos.get(e)||null}getContentSize(){return this.contentSize}getVisibleLayoutInfos(e){let t=[];for(let i of this.layoutInfos.values())(i.rect.intersects(e)||this.virtualizer.isPersistedKey(i.key)||i.type==="loader")&&t.push(i);return t}updateItemSize(e,t){let i=this.layoutInfos.get(e);if(!t||!i)return!1;if(t.height!==i.rect.height){let l=i.copy();return l.rect.height=t.height,l.estimatedSize=!1,this.layoutInfos.set(e,l),!0}return!1}getDropTargetFromPoint(e,t,i){if(this.layoutInfos.size===0)return{type:"root"};e+=this.virtualizer.visibleRect.x,t+=this.virtualizer.visibleRect.y;let l=null;if(this.numColumns===1){let s=new w(e,Math.max(0,t-this.gap.height),1,Math.max(1,this.gap.height*2)),S=this.getVisibleLayoutInfos(s),d=1/0;for(let a of S){if(!a.rect.intersects(s))continue;let b=Math.abs(a.rect.y-t),r=Math.abs(a.rect.maxY-t),u=Math.min(b,r);u<d&&(d=u,l=a.key)}}else{let s=new w(Math.max(0,e-this.gap.width),t,this.gap.width*2,1),S=this.getVisibleLayoutInfos(s),d=1/0;for(let a of S){if(!a.rect.intersects(s))continue;let b=Math.abs(a.rect.x-e),r=Math.abs(a.rect.maxX-e),u=Math.min(b,r);u<d&&(d=u,l=a.key)}}let n=l!=null?this.getLayoutInfo(l):null;if(!n)return{type:"root"};let h={type:"item",key:n.key,dropPosition:"on"},x=this.numColumns===1?t:e,M=this.numColumns===1?n.rect.y:n.rect.x,m=this.numColumns===1?n.rect.height:n.rect.width;if(i(h))x<M+5?h.dropPosition="before":x>M+m-5&&(h.dropPosition="after");else{let s=M+m/2;x<=s&&i({...h,dropPosition:"before"})?h.dropPosition="before":x>=s&&i({...h,dropPosition:"after"})&&(h.dropPosition="after")}return h}getDropTargetLayoutInfo(e){let t=this.getLayoutInfo(e.key),i;return this.numColumns===1?i=new w(t.rect.x,e.dropPosition==="before"?t.rect.y-this.gap.height/2-this.dropIndicatorThickness/2:t.rect.maxY+this.gap.height/2-this.dropIndicatorThickness/2,t.rect.width,this.dropIndicatorThickness):i=new w(e.dropPosition==="before"?t.rect.x-this.gap.width/2-this.dropIndicatorThickness/2:t.rect.maxX+this.gap.width/2-this.dropIndicatorThickness/2,t.rect.y,this.dropIndicatorThickness,t.rect.height),new q("dropIndicator",e.key+":"+e.dropPosition,i)}constructor(...e){super(...e),this.gap=o.minSpace,this.dropIndicatorThickness=2,this.numColumns=0,this.contentSize=new k,this.layoutInfos=new Map,this.margin=0}}export{G as $};
