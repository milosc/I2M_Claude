import{bd as te,bj as re,bk as oe,bl as ne,bm as ie,bn as M,bo as C,bp as le,bq as F,br as Y,bs as N,bt as ae,bu as se,bv as de,bw as j,bx as ue,by as ce,bz as pe,bA as G,bB as fe,aJ as J,bC as ge,aE as ye,aF as ve,bD as me,bE as $e}from"./Virtualizer-43kePMo2.js";import{r as I,R as V}from"./index-GiUgBvb1.js";import{f as be,g as De,h as W,e as he,d as Z}from"./ColorSwatch-C5hr6lpG.js";import{$ as Ke}from"./useDrag-D4nPEkp-.js";import{r as Pe}from"./index-C8NrMXaH.js";function xe(n,e,o,t,d=!1,f=!1){switch(t){case"left":return d?q(n,e,o,f,"left"):H(n,e,o,f,"left");case"right":return d?H(n,e,o,f,"right"):q(n,e,o,f,"right");case"up":return H(n,e,o,f);case"down":return q(n,e,o,f)}}function q(n,e,o,t=!1,d=null){if(!o)return{type:"root"};if(o.type==="root"){var f,b;let g=(b=(f=n.getFirstKey)===null||f===void 0?void 0:f.call(n))!==null&&b!==void 0?b:null;return g!=null?{type:"item",key:g,dropPosition:"before"}:null}if(o.type==="item"){var v,h,m;let g=null;d?g=d==="right"?(v=n.getKeyRightOf)===null||v===void 0?void 0:v.call(n,o.key):(h=n.getKeyLeftOf)===null||h===void 0?void 0:h.call(n,o.key):g=(m=n.getKeyBelow)===null||m===void 0?void 0:m.call(n,o.key);let y=e.getKeyAfter(o.key);if(g!=null&&g!==y)return{type:"item",key:g,dropPosition:o.dropPosition};switch(o.dropPosition){case"before":return{type:"item",key:o.key,dropPosition:"on"};case"on":{let l=e.getItem(o.key),p=g!=null?e.getItem(g):null;return l&&p&&p.level>=l.level?{type:"item",key:p.key,dropPosition:"before"}:{type:"item",key:o.key,dropPosition:"after"}}case"after":{let l=e.getItem(o.key),p=(l==null?void 0:l.nextKey)!=null?e.getItem(l.nextKey):null;for(;p!=null&&p.type!=="item";)p=p.nextKey!=null?e.getItem(p.nextKey):null;if(l&&p==null&&l.parentKey!=null){let s=e.getItem(l.parentKey);const c=(s==null?void 0:s.nextKey)!=null?e.getItem(s.nextKey):null;if((c==null?void 0:c.type)==="item")return{type:"item",key:c.key,dropPosition:"before"};if((s==null?void 0:s.type)==="item")return{type:"item",key:s.key,dropPosition:"after"}}if(p)return{type:"item",key:p.key,dropPosition:"on"}}}}return t?{type:"root"}:null}function H(n,e,o,t=!1,d=null){if(!o||t&&o.type==="root"){var f;let m=null,g=(f=n.getLastKey)===null||f===void 0?void 0:f.call(n);for(;g!=null;){let y=e.getItem(g);if((y==null?void 0:y.type)!=="item")break;m=g,g=y==null?void 0:y.parentKey}return m!=null?{type:"item",key:m,dropPosition:"after"}:null}if(o.type==="item"){var b,v,h;let m=null;d?m=d==="left"?(b=n.getKeyLeftOf)===null||b===void 0?void 0:b.call(n,o.key):(v=n.getKeyRightOf)===null||v===void 0?void 0:v.call(n,o.key):m=(h=n.getKeyAbove)===null||h===void 0?void 0:h.call(n,o.key);let g=e.getKeyBefore(o.key);if(m!=null&&m!==g)return{type:"item",key:m,dropPosition:o.dropPosition};switch(o.dropPosition){case"before":{let y=e.getItem(o.key);if(y&&y.prevKey!=null){let l=X(e,y.prevKey);if(l)return l}return m!=null?{type:"item",key:m,dropPosition:"on"}:{type:"root"}}case"on":return{type:"item",key:o.key,dropPosition:"before"};case"after":{let y=X(e,o.key);return y||{type:"item",key:o.key,dropPosition:"on"}}}}return o.type!=="root"?{type:"root"}:null}function X(n,e){let o=n.getItem(e),t=n.getKeyAfter(e),d=t!=null?n.getItem(t):null;if(o&&d&&d.level>o.level){let f=te(o,n),b=null;for(let v of f)v.type==="item"&&(b=v);if(b)return{type:"item",key:b.key,dropPosition:"after"}}return null}const L=20;function we(n){let e=I.useRef(null),o=I.useRef(!0),t=I.useRef(!0);I.useEffect(()=>{if(n.current){e.current=oe(n.current)?n.current:re(n.current);let b=window.getComputedStyle(e.current);o.current=/(auto|scroll)/.test(b.overflowX),t.current=/(auto|scroll)/.test(b.overflowY)}},[n]);let d=I.useRef({timer:void 0,dx:0,dy:0}).current;I.useEffect(()=>()=>{d.timer&&(cancelAnimationFrame(d.timer),d.timer=void 0)},[d]);let f=I.useCallback(()=>{o.current&&e.current&&(e.current.scrollLeft+=d.dx),t.current&&e.current&&(e.current.scrollTop+=d.dy),d.timer&&(d.timer=requestAnimationFrame(f))},[e,d]);return{move(b,v){if(!ne()||ie()||!e.current)return;let h=e.current.getBoundingClientRect(),m=L,g=L,y=h.height-L,l=h.width-L;b<m||b>l||v<g||v>y?(b<m?d.dx=b-m:b>l&&(d.dx=b-l),v<g?d.dy=v-g:v>y&&(d.dy=v-y),d.timer||(d.timer=requestAnimationFrame(f))):this.stop()},stop(){d.timer&&(cancelAnimationFrame(d.timer),d.timer=void 0)}}}function Ie(n,e,o){let t=I.useRef({props:n,state:e,nextTarget:null,dropOperation:null}).current;t.props=n,t.state=e;let d=I.useCallback(async l=>{let{onInsert:p,onRootDrop:s,onItemDrop:c,onReorder:a,onMove:u,acceptedDragTypes:$="all",shouldAcceptItemDrop:r}=t.props,{draggingKeys:i}=M,x=C(o),{target:P,dropOperation:K,items:k}=l,w=k;($!=="all"||r)&&(w=k.filter(R=>{let T;return R.kind==="directory"?T=new Set([de]):T=R.kind==="file"?new Set([R.type]):R.types,$==="all"||$.some(E=>T.has(E))?P.type==="item"&&P.dropPosition==="on"&&r?r(P,T):!0:!1})),w.length>0&&(P.type==="root"&&s&&await s({items:w,dropOperation:K}),P.type==="item"&&(P.dropPosition==="on"&&c&&await c({items:w,dropOperation:K,isInternal:x,target:P}),u&&x&&await u({keys:i,dropOperation:K,target:P}),P.dropPosition!=="on"&&(!x&&p&&await p({items:w,dropOperation:K,target:P}),x&&a&&await a({keys:i,dropOperation:K,target:P}))))},[t,o]),f=we(o),{dropProps:b}=le({ref:o,onDropEnter(){t.nextTarget!=null&&e.setTarget(t.nextTarget)},onDropMove(l){t.nextTarget!=null&&e.setTarget(t.nextTarget),f.move(l.x,l.y)},getDropOperationForPoint(l,p,s,c){let{draggingKeys:a,dropCollectionRef:u}=M,$=C(o),r=x=>e.getDropOperation({target:x,types:l,allowedOperations:p,isInternal:$,draggingKeys:a})!=="cancel",i=n.dropTargetDelegate.getDropTargetFromPoint(s,c,r);if(!i)return t.dropOperation="cancel",t.nextTarget=null,"cancel";if(t.dropOperation=e.getDropOperation({target:i,types:l,allowedOperations:p,isInternal:$,draggingKeys:a}),t.dropOperation==="cancel"){let x={type:"root"},P=e.getDropOperation({target:x,types:l,allowedOperations:p,isInternal:$,draggingKeys:a});P!=="cancel"&&(i=x,t.dropOperation=P)}return i&&t.dropOperation!=="cancel"&&(o==null?void 0:o.current)!==(u==null?void 0:u.current)&&F(o),t.nextTarget=t.dropOperation==="cancel"?null:i,t.dropOperation},onDropExit(){F(void 0),e.setTarget(null),f.stop()},onDropActivate(l){var p;((p=e.target)===null||p===void 0?void 0:p.type)==="item"&&typeof n.onDropActivate=="function"&&n.onDropActivate({type:"dropactivate",x:l.x,y:l.y,target:e.target})},onDrop(l){F(o),e.target&&m(l,e.target);let{draggingCollectionRef:p}=M;p==null&&Y()}}),v=I.useRef(null),h=I.useCallback(()=>{let{state:l}=t;if(v.current){var p;let{target:a,collection:u,selectedKeys:$,focusedKey:r,isInternal:i,draggingKeys:x}=v.current;if(l.collection.size>u.size&&l.selectionManager.isSelectionEqual($)){let P=new Set;for(let K of l.collection.getKeys())u.getItem(K)||P.add(K);if(l.selectionManager.setSelectedKeys(P),l.selectionManager.focusedKey===r){let K=P.keys().next().value;if(K!=null){let k=l.collection.getItem(K);(k==null?void 0:k.type)==="cell"&&(K=k.parentKey),K!=null&&l.selectionManager.setFocusedKey(K),l.selectionManager.selectionMode==="none"&&N("keyboard")}}}else if(r!=null&&l.selectionManager.focusedKey===r&&i&&a.type==="item"&&a.dropPosition!=="on"&&x.has((p=l.collection.getItem(r))===null||p===void 0?void 0:p.parentKey)){var s,c;l.selectionManager.setFocusedKey((c=(s=l.collection.getItem(r))===null||s===void 0?void 0:s.parentKey)!==null&&c!==void 0?c:null),N("keyboard")}else l.selectionManager.focusedKey===r&&a.type==="item"&&a.dropPosition==="on"&&l.collection.getItem(a.key)!=null?(l.selectionManager.setFocusedKey(a.key),N("keyboard")):l.selectionManager.focusedKey!=null&&!l.selectionManager.isSelected(l.selectionManager.focusedKey)&&N("keyboard");l.selectionManager.setFocused(!0)}},[t]),m=I.useCallback((l,p)=>{let{state:s}=t;v.current={timeout:void 0,focusedKey:s.selectionManager.focusedKey,collection:s.collection,selectedKeys:s.selectionManager.selectedKeys,draggingKeys:M.draggingKeys,isInternal:C(o),target:p},(t.props.onDrop||d)({type:"drop",x:l.x,y:l.y,target:p,items:l.items,dropOperation:l.dropOperation}),v.current.timeout=setTimeout(()=>{h(),v.current=null},50)},[t,d,o,h]);I.useEffect(()=>()=>{v.current&&clearTimeout(v.current.timeout)},[]),be(()=>{v.current&&e.collection!==v.current.collection&&h()});let{direction:g}=De();I.useEffect(()=>{if(!o.current)return;let l=(c,a=!0,u="down")=>xe(t.props.keyboardDelegate,t.state.collection,c,u,g==="rtl",a),p=(c,a=!0)=>l(c,a,"up"),s=(c,a,u,$,r=!0)=>{let i=0,x,{draggingKeys:P}=M,K=C(o);do{let k=$(c,r);if(!k)return null;c=k,x=t.state.getDropOperation({target:k,types:a,allowedOperations:u,isInternal:K,draggingKeys:P}),c.type==="root"&&i++}while(x==="cancel"&&!t.state.isDropTarget(c)&&i<2);return x==="cancel"?null:c};return ae({element:o.current,preventFocusOnDrop:!0,getDropOperation(c,a){if(t.state.target){let{draggingKeys:$}=M,r=C(o);return t.state.getDropOperation({target:t.state.target,types:c,allowedOperations:a,isInternal:r,draggingKeys:$})}return s(null,c,a,l)?"move":"cancel"},onDropEnter(c,a){let u=j(a.items),$=t.state.selectionManager,r=null;F(o);let i=$.focusedKey,x="after",P=i!=null?t.state.collection.getItem(i):null;if((P==null?void 0:P.type)==="cell"&&(i=P.parentKey),i!=null&&$.isSelected(i)&&($.selectedKeys.size>1&&$.firstSelectedKey===i?x="before":i=$.lastSelectedKey),i!=null){r={type:"item",key:i,dropPosition:x};let{draggingKeys:k}=M,w=C(o);var K;t.state.getDropOperation({target:r,types:u,allowedOperations:a.allowedDropOperations,isInternal:w,draggingKeys:k})==="cancel"&&(r=(K=s(r,u,a.allowedDropOperations,l,!1))!==null&&K!==void 0?K:s(r,u,a.allowedDropOperations,p,!1))}r||(r=s(null,u,a.allowedDropOperations,l)),t.state.setTarget(r)},onDropExit(){F(void 0),t.state.setTarget(null)},onDropTargetEnter(c){t.state.setTarget(c)},onDropActivate(c,a){(a==null?void 0:a.type)==="item"&&(a==null?void 0:a.dropPosition)==="on"&&typeof t.props.onDropActivate=="function"&&t.props.onDropActivate({type:"dropactivate",x:c.x,y:c.y,target:a})},onDrop(c,a){F(o),t.state.target&&m(c,a||t.state.target)},onKeyDown(c,a){var u,$;let{keyboardDelegate:r}=t.props,i=j(a.items);switch(c.key){case"ArrowDown":if(r.getKeyBelow){let D=s(t.state.target,i,a.allowedDropOperations,(O,S)=>l(O,S,"down"));t.state.setTarget(D)}break;case"ArrowUp":if(r.getKeyAbove){let D=s(t.state.target,i,a.allowedDropOperations,(O,S)=>l(O,S,"up"));t.state.setTarget(D)}break;case"ArrowLeft":if(r.getKeyLeftOf){let D=s(t.state.target,i,a.allowedDropOperations,(O,S)=>l(O,S,"left"));t.state.setTarget(D)}break;case"ArrowRight":if(r.getKeyRightOf){let D=s(t.state.target,i,a.allowedDropOperations,(O,S)=>l(O,S,"right"));t.state.setTarget(D)}break;case"Home":if(r.getFirstKey){let D=s(null,i,a.allowedDropOperations,l);t.state.setTarget(D)}break;case"End":if(r.getLastKey){let D=s(null,i,a.allowedDropOperations,p);t.state.setTarget(D)}break;case"PageDown":if(r.getKeyPageBelow){let D=t.state.target;if(!D)D=s(null,i,a.allowedDropOperations,l);else{var x,P;let O=(x=r.getFirstKey)===null||x===void 0?void 0:x.call(r);D.type==="item"&&(O=D.key);let S=null;O!=null&&(S=r.getKeyPageBelow(O));let B=D.type==="item"?D.dropPosition:"after";if(S==null||D.type==="item"&&D.key===((P=r.getLastKey)===null||P===void 0?void 0:P.call(r))){var K,k;S=(k=(K=r.getLastKey)===null||K===void 0?void 0:K.call(r))!==null&&k!==void 0?k:null,B="after"}if(S==null)break;D={type:"item",key:S,dropPosition:B};let{draggingCollectionRef:A,draggingKeys:z}=M,_=(A==null?void 0:A.current)===(o==null?void 0:o.current),ee=t.state.getDropOperation({target:D,types:i,allowedOperations:a.allowedDropOperations,isInternal:_,draggingKeys:z});var w;ee==="cancel"&&(D=(w=s(D,i,a.allowedDropOperations,l,!1))!==null&&w!==void 0?w:s(D,i,a.allowedDropOperations,p,!1))}t.state.setTarget(D??t.state.target)}break;case"PageUp":{if(!r.getKeyPageAbove)break;let D=t.state.target;if(!D)D=s(null,i,a.allowedDropOperations,p);else if(D.type==="item"){var R;if(D.key===((R=r.getFirstKey)===null||R===void 0?void 0:R.call(r)))D={type:"root"};else{let A=r.getKeyPageAbove(D.key),z=D.dropPosition;if(A==null){var T;A=(T=r.getFirstKey)===null||T===void 0?void 0:T.call(r),z="before"}if(A==null)break;D={type:"item",key:A,dropPosition:z}}let{draggingKeys:O}=M,S=C(o),B=t.state.getDropOperation({target:D,types:i,allowedOperations:a.allowedDropOperations,isInternal:S,draggingKeys:O});var E;B==="cancel"&&(D=(E=s(D,i,a.allowedDropOperations,p,!1))!==null&&E!==void 0?E:s(D,i,a.allowedDropOperations,l,!1))}t.state.setTarget(D??t.state.target);break}}(u=($=t.props).onKeyDown)===null||u===void 0||u.call($,c)}})},[t,o,m,g]);let y=W();return se.set(e,{id:y,ref:o}),{collectionProps:he(b,{id:y,"aria-describedby":null})}}function Q(n,e,o){let{dropProps:t}=ue(),d=ce(e);I.useEffect(()=>{if(o.current)return pe({element:o.current,target:n.target,getDropOperation(g,y){let{draggingKeys:l}=M,p=C(d);return e.getDropOperation({target:n.target,types:g,allowedOperations:y,isInternal:p,draggingKeys:l})},activateButtonRef:n.activateButtonRef})},[o,n.target,e,d,n.activateButtonRef]);let f=G(),{draggingKeys:b}=M,v=C(d),h=f&&e.getDropOperation({target:n.target,types:j(f.dragTarget.items),allowedOperations:f.dragTarget.allowedDropOperations,isInternal:v,draggingKeys:b})!=="cancel",m=e.isDropTarget(n.target);return I.useEffect(()=>{f&&m&&o.current&&o.current.focus()},[m,f,o]),{dropProps:{...t,"aria-hidden":!f||h?void 0:"true"},isDropTarget:m}}function ke(n){return n&&n.__esModule?n.default:n}function Oe(n,e,o){let{target:t}=n,{collection:d}=e,f=Z(ke(J),"@react-aria/dnd"),b=G(),{dropProps:v}=Q(n,e,o),h=W(),m=a=>{var u,$,r,i;return a==null?"":(i=(r=(u=d.getTextValue)===null||u===void 0?void 0:u.call(d,a))!==null&&r!==void 0?r:($=d.getItem(a))===null||$===void 0?void 0:$.textValue)!==null&&i!==void 0?i:""},g="",y;if(t.type==="root")g=f.format("dropOnRoot"),y=`${h} ${fe(e)}`;else if(t.dropPosition==="on")g=f.format("dropOnItem",{itemText:m(t.key)});else{let a,u;if(t.dropPosition==="before"){var l;let $=(l=d.getItem(t.key))===null||l===void 0?void 0:l.prevKey,r=$!=null?d.getItem($):null;a=(r==null?void 0:r.type)==="item"?r.key:null}else a=t.key;if(t.dropPosition==="after"){var p;let $=(p=d.getItem(t.key))===null||p===void 0?void 0:p.nextKey,r=$!=null?d.getItem($):null;u=(r==null?void 0:r.type)==="item"?r.key:null}else u=t.key;a!=null&&u!=null?g=f.format("insertBetween",{beforeItemText:m(a),afterItemText:m(u)}):a!=null?g=f.format("insertAfter",{itemText:m(a)}):u!=null&&(g=f.format("insertBefore",{itemText:m(u)}))}let s=e.isDropTarget(t),c=b?v["aria-hidden"]:"true";return{dropIndicatorProps:{...v,id:h,"aria-roledescription":f.format("dropIndicator"),"aria-label":g,"aria-labelledby":y,"aria-hidden":c,tabIndex:-1},isDropTarget:s,isHidden:!s&&!!c}}function Se(n){return n&&n.__esModule?n.default:n}const Re={keyboard:{selected:"dragSelectedKeyboard",notSelected:"dragDescriptionKeyboard"},touch:{selected:"dragSelectedLongPress",notSelected:"dragDescriptionLongPress"},virtual:{selected:"dragDescriptionVirtual",notSelected:"dragDescriptionVirtual"}};function Me(n,e){let o=Z(Se(J),"@react-aria/dnd"),t=e.isDisabled||e.selectionManager.isDisabled(n.key),{dragProps:d,dragButtonProps:f}=Ke({getItems(){return e.getItems(n.key)},preview:e.preview,getAllowedDropOperations:e.getAllowedDropOperations,hasDragButton:n.hasDragButton,onDragStart(u){e.startDrag(n.key,u),ge(e.draggingKeys)},onDragMove(u){e.moveDrag(u)},onDragEnd(u){let{dropOperation:$}=u,r=$==="cancel"?!1:C();e.endDrag({...u,keys:e.draggingKeys,isInternal:r}),Y()}}),b=e.collection.getItem(n.key),v=e.getKeysForDrag(n.key).size,h=v>1&&e.selectionManager.isSelected(n.key),m,g,y=ye();if(!n.hasDragButton&&e.selectionManager.selectionMode!=="none"){let u=Re[y][h?"selected":"notSelected"];n.hasAction&&y==="keyboard"&&(u+="Alt"),h?g=o.format(u,{count:v}):g=o.format(u),delete d.onClick}else if(h)m=o.format("dragSelectedItems",{count:v});else{var l,p,s,c;let u=(c=(s=(l=(p=e.collection).getTextValue)===null||l===void 0?void 0:l.call(p,n.key))!==null&&s!==void 0?s:b==null?void 0:b.textValue)!==null&&c!==void 0?c:"";m=o.format("dragItem",{itemText:u})}let a=ve(g);if(g&&Object.assign(d,a),!n.hasDragButton&&n.hasAction){let{onKeyDownCapture:u,onKeyUpCapture:$}=d;y==="touch"&&delete d["aria-describedby"],d.onKeyDownCapture=r=>{r.altKey&&(u==null||u(r))},d.onKeyUpCapture=r=>{r.altKey&&($==null||$(r))}}return{dragProps:t?{}:d,dragButtonProps:{...f,isDisabled:t,"aria-label":m}}}function Te(n,e,o){let{draggingCollectionRef:t}=M;e.draggingKeys.size>0&&(t==null?void 0:t.current)!==o.current&&me(o)}const Ce=V.forwardRef(function(e,o){let t=e.children,[d,f]=I.useState(null),b=I.useRef(null),v=I.useRef(void 0);return I.useImperativeHandle(o,()=>(h,m)=>{let g=t(h),y,l,p;g&&typeof g=="object"&&"element"in g?(y=g.element,l=g.x,p=g.y):y=g,Pe.flushSync(()=>{f(y)}),m(b.current,l,p),v.current=requestAnimationFrame(()=>{f(null)})},[t]),I.useEffect(()=>()=>{v.current&&cancelAnimationFrame(v.current)},[]),d?V.createElement("div",{style:{zIndex:-100,position:"fixed",top:0,left:-1e5},ref:b},d):null});class Ae{getPrimaryStart(e){return this.orientation==="horizontal"?e.left:e.top}getPrimaryEnd(e){return this.orientation==="horizontal"?e.right:e.bottom}getSecondaryStart(e){return this.orientation==="horizontal"?e.top:e.left}getSecondaryEnd(e){return this.orientation==="horizontal"?e.bottom:e.right}getFlowStart(e){return this.layout==="stack"?this.getPrimaryStart(e):this.getSecondaryStart(e)}getFlowEnd(e){return this.layout==="stack"?this.getPrimaryEnd(e):this.getSecondaryEnd(e)}getFlowSize(e){return this.getFlowEnd(e)-this.getFlowStart(e)}getDropTargetFromPoint(e,o,t){var d;if(this.collection[Symbol.iterator]().next().done||!this.ref.current)return{type:"root"};let f=this.ref.current.getBoundingClientRect(),b=this.orientation==="horizontal"?e:o,v=this.orientation==="horizontal"?o:e;b+=this.getPrimaryStart(f),v+=this.getSecondaryStart(f);let h=this.layout==="stack"?b:v,m=this.orientation==="horizontal"&&this.direction==="rtl",g=this.layout==="grid"&&this.orientation==="vertical"&&this.direction==="rtl",y=this.layout==="stack"?m:g,l=(d=this.ref.current)===null||d===void 0?void 0:d.dataset.collection,p=this.ref.current.querySelectorAll(l?`[data-collection="${CSS.escape(l)}"]`:"[data-key]"),s=new Map;for(let i of p)i instanceof HTMLElement&&i.dataset.key!=null&&s.set(i.dataset.key,i);let c=[...this.collection].filter(i=>i.type==="item"),a=0,u=c.length;for(;a<u;){let i=Math.floor((a+u)/2),x=c[i],P=s.get(String(x.key));if(!P)break;let K=P.getBoundingClientRect(),k=w=>{w?a=i+1:u=i};if(b<this.getPrimaryStart(K))k(m);else if(b>this.getPrimaryEnd(K))k(!m);else if(v<this.getSecondaryStart(K))k(g);else if(v>this.getSecondaryEnd(K))k(!g);else{let w={type:"item",key:x.key,dropPosition:"on"};if(t(w))h<=this.getFlowStart(K)+5&&t({...w,dropPosition:"before"})?w.dropPosition=y?"after":"before":h>=this.getFlowEnd(K)-5&&t({...w,dropPosition:"after"})&&(w.dropPosition=y?"before":"after");else{let R=this.getFlowStart(K)+this.getFlowSize(K)/2;h<=R&&t({...w,dropPosition:"before"})?w.dropPosition=y?"after":"before":h>=R&&t({...w,dropPosition:"after"})&&(w.dropPosition=y?"before":"after")}return w}}let $=c[Math.min(a,c.length-1)],r=s.get(String($.key));return f=r==null?void 0:r.getBoundingClientRect(),f&&(b<this.getPrimaryStart(f)||Math.abs(h-this.getFlowStart(f))<Math.abs(h-this.getFlowEnd(f)))?{type:"item",key:$.key,dropPosition:y?"after":"before"}:{type:"item",key:$.key,dropPosition:y?"before":"after"}}constructor(e,o,t){this.collection=e,this.ref=o,this.layout=(t==null?void 0:t.layout)||"stack",this.orientation=(t==null?void 0:t.orientation)||"vertical",this.direction=(t==null?void 0:t.direction)||"ltr"}}function Ee(n){let{getItems:e,isDisabled:o,collection:t,selectionManager:d,onDragStart:f,onDragMove:b,onDragEnd:v,preview:h,getAllowedDropOperations:m}=n,[,g]=I.useState(!1),y=I.useRef(new Set),l=I.useRef(null),p=s=>{let c=new Set;if(d.isSelected(s))for(let a of d.selectedKeys){let u=t.getItem(a);if(u){let $=!1,r=u.parentKey;for(;r!=null;){if(d.selectedKeys.has(r)){$=!0;break}let i=t.getItem(r);r=i?i.parentKey:null}$||c.add(a)}}else c.add(s);return c};return{collection:t,selectionManager:d,get draggedKey(){return l.current},get draggingKeys(){return y.current},isDragging(s){return y.current.has(s)},getKeysForDrag:p,getItems(s){let c=p(s),a=[];for(let $ of c){var u;let r=(u=t.getItem($))===null||u===void 0?void 0:u.value;r!=null&&a.push(r)}return e(p(s),a)},isDisabled:o,preview:h,getAllowedDropOperations:m,startDrag(s,c){let a=p(s);y.current=a,l.current=s,d.setFocused(!1),g(!0),typeof f=="function"&&f({...c,keys:a})},moveDrag(s){typeof b=="function"&&b({...s,keys:y.current})},endDrag(s){let{isInternal:c}=s;typeof v=="function"&&v({...s,keys:y.current,isInternal:c}),y.current=new Set,l.current=null,g(!1)}}}function Fe(n){let{acceptedDragTypes:e="all",isDisabled:o,onInsert:t,onRootDrop:d,onItemDrop:f,onReorder:b,onMove:v,shouldAcceptItemDrop:h,collection:m,selectionManager:g,onDropEnter:y,getDropOperation:l,onDrop:p}=n,[s,c]=I.useState(null),a=I.useRef(null),u=r=>{if(r.dropPosition==="before"){let i=m.getItem(r.key);return i&&i.prevKey!=null?{type:"item",key:i.prevKey,dropPosition:"after"}:null}else if(r.dropPosition==="after"){let i=m.getItem(r.key);return i&&i.nextKey!=null?{type:"item",key:i.nextKey,dropPosition:"before"}:null}return null},$=I.useCallback(r=>{let{target:i,types:x,allowedOperations:P,isInternal:K,draggingKeys:k}=r;if(o||!i)return"cancel";if(e==="all"||e.some(w=>x.has(w))){let w=t&&i.type==="item"&&!K&&(i.dropPosition==="before"||i.dropPosition==="after"),R=b&&i.type==="item"&&K&&(i.dropPosition==="before"||i.dropPosition==="after")&&Be(m,i,k),T=i.type!=="item"||i.dropPosition!=="on"||!h||h(i,x),E=v&&i.type==="item"&&K&&T,D=d&&i.type==="root"&&!K,O=f&&i.type==="item"&&i.dropPosition==="on"&&!(K&&i.key!=null&&k.has(i.key))&&T;if(p||w||R||E||D||O)return l?l(i,x,P):P[0]}return"cancel"},[o,m,e,l,t,d,f,h,b,v,p]);return{collection:m,selectionManager:g,isDisabled:o,target:s,setTarget(r){if(this.isDropTarget(r))return;let i=a.current;i&&typeof n.onDropExit=="function"&&n.onDropExit({type:"dropexit",x:0,y:0,target:i}),r&&typeof y=="function"&&y({type:"dropenter",x:0,y:0,target:r}),a.current=r??null,c(r??null)},isDropTarget(r){let i=a.current;return!i||!r?!1:U(r,i)?!0:(r==null?void 0:r.type)==="item"&&(i==null?void 0:i.type)==="item"&&r.key!==i.key&&r.dropPosition!==i.dropPosition&&r.dropPosition!=="on"&&i.dropPosition!=="on"?U(u(r),i)||U(r,u(i)):!1},getDropOperation(r){return $(r)}}}function U(n,e){if(!n)return!e;switch(n.type){case"root":return(e==null?void 0:e.type)==="root";case"item":return(e==null?void 0:e.type)==="item"&&(e==null?void 0:e.key)===n.key&&(e==null?void 0:e.dropPosition)===n.dropPosition}}function Be(n,e,o){let t=n.getItem(e.key);for(let d of o){let f=n.getItem(d);if((f==null?void 0:f.parentKey)!==(t==null?void 0:t.parentKey))return!1}return!0}function Ue(n){return{dragAndDropHooks:I.useMemo(()=>{let{onDrop:o,onInsert:t,onItemDrop:d,onReorder:f,onMove:b,onRootDrop:v,getItems:h,renderDragPreview:m,renderDropIndicator:g,dropTargetDelegate:y}=n,l=!!h,p=!!(o||t||d||f||b||v),s={};return l&&(s.useDraggableCollectionState=function(a){return Ee({...a,...n})},s.useDraggableCollection=Te,s.useDraggableItem=Me,s.DragPreview=Ce,s.renderDragPreview=m,s.isVirtualDragging=$e),p&&(s.useDroppableCollectionState=function(a){return Fe({...a,...n})},s.useDroppableItem=Q,s.useDroppableCollection=function(a,u,$){return Ie({...a,...n},u,$)},s.useDropIndicator=Oe,s.renderDropIndicator=g,s.dropTargetDelegate=y,s.ListDropTargetDelegate=Ae),s},[n])}}export{Ue as u};
