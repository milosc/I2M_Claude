import{r as S}from"./index-GiUgBvb1.js";function _(I){let{initialItems:K=[],initialSelectedKeys:f,getKey:h=e=>{var l;return(l=e.id)!==null&&l!==void 0?l:e.key},getChildren:O=e=>e.children}=I,[$,a]=S.useState(()=>w(K,new Map)),{items:m,nodeMap:c}=$,[M,g]=S.useState(new Set(f||[]));function w(e=[],l,t){return e==null&&(e=[]),{items:e.map(i=>{let r={key:h(i),parentKey:t??null,value:i,children:null};return r.children=w(O(i),l,r.key).items,l.set(r.key,r),r}),nodeMap:l}}function y(e,l,t,i){let r=l==null?null:i.get(l);if(r==null)return{items:e,nodeMap:i};let u=new Map(i),s=t(r);for(s==null?x(r,u):p(s,u);r&&r.parentKey;){let d=u.get(r.parentKey),o={key:d.key,parentKey:d.parentKey,value:d.value,children:null},v=d.children;s==null&&v&&(v=v.filter(k=>k!==r));var n;o.children=(n=v==null?void 0:v.map(k=>k===r?s:k))!==null&&n!==void 0?n:null,u.set(o.key,o),s=o,r=d}return s==null&&(e=e.filter(d=>d!==r)),{items:e.map(d=>d===r?s:d),nodeMap:u}}function p(e,l){if(l.set(e.key,e),e.children)for(let t of e.children)p(t,l)}function x(e,l){if(l.delete(e.key),e.children)for(let t of e.children)x(t,l)}return{items:m,selectedKeys:M,setSelectedKeys:g,getItem(e){return c.get(e)},insert(e,l,...t){a(({items:i,nodeMap:r})=>{let{items:u,nodeMap:s}=w(t,r,e);return e==null?{items:[...i.slice(0,l),...u,...i.slice(l)],nodeMap:s}:y(i,e,n=>({key:n.key,parentKey:n.parentKey,value:n.value,children:[...n.children.slice(0,l),...u,...n.children.slice(l)]}),s)})},insertBefore(e,...l){let t=c.get(e);if(!t)return;let i=c.get(t.parentKey),u=(i?i.children:m).indexOf(t);var s;this.insert((s=i==null?void 0:i.key)!==null&&s!==void 0?s:null,u,...l)},insertAfter(e,...l){let t=c.get(e);if(!t)return;let i=c.get(t.parentKey),u=(i?i.children:m).indexOf(t);var s;this.insert((s=i==null?void 0:i.key)!==null&&s!==void 0?s:null,u+1,...l)},prepend(e,...l){this.insert(e,0,...l)},append(e,...l){if(e==null)this.insert(null,m.length,...l);else{let t=c.get(e);if(!t)return;this.insert(e,t.children.length,...l)}},remove(...e){if(e.length===0)return;let l=m,t=c,i;for(let u of e)i=y(l,u,()=>null,t),t=i.nodeMap,l=i.items;a(i);let r=new Set(M);for(let u of M)i.nodeMap.has(u)||r.delete(u);g(r)},removeSelectedItems(){this.remove(...M)},move(e,l,t){a(({items:i,nodeMap:r})=>{let u=r.get(e);if(!u)return{items:i,nodeMap:r};let{items:s,nodeMap:n}=y(i,e,()=>null,r);const d={...u,parentKey:l};return l==null?(p(d,n),{items:[...s.slice(0,t),d,...s.slice(t)],nodeMap:n}):y(s,l,o=>({key:o.key,parentKey:o.parentKey,value:o.value,children:[...o.children.slice(0,t),d,...o.children.slice(t)]}),n)})},moveBefore(e,l){a(t=>{let{items:i,nodeMap:r}=t,u=r.get(e);if(!u)return t;var s;let n=(s=u.parentKey)!==null&&s!==void 0?s:null,d=null;var o;n!=null&&(d=(o=r.get(n))!==null&&o!==void 0?o:null);let v=d!=null&&d.children?d.children.indexOf(u):i.indexOf(u);return A(t,l,d,v,y,p)})},moveAfter(e,l){a(t=>{let{items:i,nodeMap:r}=t,u=r.get(e);if(!u)return t;var s;let n=(s=u.parentKey)!==null&&s!==void 0?s:null,d=null;var o;n!=null&&(d=(o=r.get(n))!==null&&o!==void 0?o:null);let v=d!=null&&d.children?d.children.indexOf(u):i.indexOf(u);return v++,A(t,l,d,v,y,p)})},update(e,l){a(({items:t,nodeMap:i})=>y(t,e,r=>{let u={key:r.key,parentKey:r.parentKey,value:l,children:null},s=w(O(l),i,u.key);return u.children=s.items,u},i))}}}function A(I,K,f,h,O,$){let{items:a,nodeMap:m}=I,c=f,M=new Set(K);for(;(c==null?void 0:c.parentKey)!=null;){if(M.has(c.key))throw new Error("Cannot move an item to be a child of itself.");var g;c=(g=m.get(c.parentKey))!==null&&g!==void 0?g:null}let w=h,y=Array.isArray(K)?K:[...K],p=new Map,x=[],e=a,l=m,t=0;function i(n,{inorder:d,postorder:o}){d==null||d(n);var v;if(n!=null)for(let k of(v=n.children)!==null&&v!==void 0?v:[])i(k,{inorder:d,postorder:o}),o==null||o(k)}function r(n){y.includes(n.key)&&p.set(n.key,t++)}function u(n){if(y.includes(n.key)){var d;x.push({...l.get(n.key),parentKey:(d=f==null?void 0:f.key)!==null&&d!==void 0?d:null});let{items:o,nodeMap:v}=O(e,n.key,()=>null,l);e=o,l=v}(n.parentKey===f||n.parentKey===(f==null?void 0:f.key))&&y.includes(n.key)&&(f!=null&&f.children?f.children.indexOf(n):a.indexOf(n))<w&&h--}i({children:a},{inorder:r,postorder:u});let s=x.sort((n,d)=>p.get(n.key)>p.get(d.key)?1:-1);return!f||f.key==null?(s.forEach(n=>{$(n,l)}),{items:[...e.slice(0,h),...s,...e.slice(h)],nodeMap:l}):O(e,f.key,n=>({key:n.key,parentKey:n.parentKey,value:n.value,children:[...n.children.slice(0,h),...s,...n.children.slice(h)]}),l)}export{_ as $};
