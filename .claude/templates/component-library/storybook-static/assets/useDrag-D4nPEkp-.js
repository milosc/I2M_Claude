import{aA as H,aB as x,aC as m,aD as d,aE as J,aF as N,aG as U,aH as j,aI as w,aJ as Q,aK as W,aL as O,aM as Z,aN as tt}from"./Virtualizer-43kePMo2.js";import{r as f}from"./index-GiUgBvb1.js";import{d as et}from"./ColorSwatch-C5hr6lpG.js";function rt(e){return e&&e.__esModule?e.default:e}const B={keyboard:{start:"dragDescriptionKeyboard",end:"endDragKeyboard"},touch:{start:"dragDescriptionTouch",end:"endDragTouch"},virtual:{start:"dragDescriptionVirtual",end:"endDragVirtual"}};function it(e){let{hasDragButton:C,isDisabled:R}=e,E=et(rt(Q),"@react-aria/dnd"),a=f.useRef({options:e,x:0,y:0}).current;a.options=e;let y=f.useRef(null),[T,_]=f.useState(!1),c=t=>{y.current=t,_(!!t)},{addGlobalListener:k,removeAllGlobalListeners:G}=H(),o=f.useRef(null),I=t=>{var r,p,s;if(t.defaultPrevented)return;if(t.stopPropagation(),o.current==="virtual"){t.preventDefault(),g(t.target),o.current=null;return}typeof e.onDragStart=="function"&&e.onDragStart({type:"dragstart",x:t.clientX,y:t.clientY});let u=e.getItems();(r=(p=t.dataTransfer).clearData)===null||r===void 0||r.call(p),Z(t.dataTransfer,u);let l=d.all;if(typeof e.getAllowedDropOperations=="function"){let n=e.getAllowedDropOperations();l=d.none;for(let D of n)l|=d[D]||d.none}m(l);let S=tt[l]||"none";t.dataTransfer.effectAllowed=S==="cancel"?"none":S,typeof((s=e.preview)===null||s===void 0?void 0:s.current)=="function"&&e.preview.current(u,(n,D,X)=>{if(!n)return;let i=n.getBoundingClientRect(),Y=t.currentTarget.getBoundingClientRect(),h=t.clientX-Y.x,v=t.clientY-Y.y;(h>i.width||v>i.height)&&(h=i.width/2,v=i.height/2);let $=h,b=v;typeof D=="number"&&typeof X=="number"&&($=D,b=X),$=Math.max(0,Math.min($,i.width)),b=Math.max(0,Math.min(b,i.height));let z=2*Math.round(i.height/2);n.style.height=`${z}px`,t.dataTransfer.setDragImage(n,$,b)}),k(window,"drop",n=>{n.preventDefault(),n.stopPropagation(),console.warn("Drags initiated from the React Aria useDrag hook may only be dropped on a target created with useDrop. This ensures that a keyboard and screen reader accessible alternative is available.")},{once:!0}),a.x=t.clientX,a.y=t.clientY;let q=t.target;requestAnimationFrame(()=>{c(q)})},K=t=>{t.stopPropagation(),!(t.clientX===a.x&&t.clientY===a.y)&&(typeof e.onDragMove=="function"&&e.onDragMove({type:"dragmove",x:t.clientX,y:t.clientY}),a.x=t.clientX,a.y=t.clientY)},L=t=>{if(t.stopPropagation(),typeof e.onDragEnd=="function"){let r={type:"dragend",x:t.clientX,y:t.clientY,dropOperation:x[t.dataTransfer.dropEffect]};w&&(r.dropOperation=x[w]),e.onDragEnd(r)}c(null),G(),m(d.none),O(void 0)};f.useEffect(()=>()=>{if(y.current&&(!y.current.isConnected||parseInt(f.version,10)<17)){if(typeof a.options.onDragEnd=="function"){let t={type:"dragend",x:0,y:0,dropOperation:x[w||"none"]};a.options.onDragEnd(t)}c(null),m(d.none),O(void 0)}},[a]);let F=t=>{t.pointerType!=="keyboard"&&t.pointerType!=="virtual"||g(t.target)},g=t=>{if(typeof a.options.onDragStart=="function"){let r=t.getBoundingClientRect();a.options.onDragStart({type:"dragstart",x:r.x+r.width/2,y:r.y+r.height/2})}W({element:t,items:a.options.getItems(),allowedDropOperations:typeof a.options.getAllowedDropOperations=="function"?a.options.getAllowedDropOperations():["move","copy","link"],onDragEnd(r){c(null),typeof a.options.onDragEnd=="function"&&a.options.onDragEnd(r)}},E),c(t)},P=J(),V=T?B[P].end:B[P].start,A=N(E.format(V)),M={};return C||(M={...A,onPointerDown(t){if(o.current=j(t.nativeEvent)?"virtual":t.pointerType,t.width<1&&t.height<1)o.current="virtual";else{let r=t.currentTarget.getBoundingClientRect(),p=t.clientX-r.x,s=t.clientY-r.y,u=r.width/2,l=r.height/2;Math.abs(p-u)<=.5&&Math.abs(s-l)<=.5?o.current="virtual":o.current=t.pointerType}},onKeyDownCapture(t){t.target===t.currentTarget&&t.key==="Enter"&&(t.preventDefault(),t.stopPropagation())},onKeyUpCapture(t){t.target===t.currentTarget&&t.key==="Enter"&&(t.preventDefault(),t.stopPropagation(),g(t.target))},onClick(t){(U(t.nativeEvent)||o.current==="virtual")&&(t.preventDefault(),t.stopPropagation(),g(t.target))}}),R?{dragProps:{draggable:"false"},dragButtonProps:{},isDragging:!1}:{dragProps:{...M,draggable:"true",onDragStart:I,onDrag:K,onDragEnd:L},dragButtonProps:{...A,onPress:F},isDragging:T}}export{it as $};
